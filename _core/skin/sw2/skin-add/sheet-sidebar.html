<div style="position:absolute;bottom:4px;left:4px;" id="appendTextConsole"></div>
<script src="https://shunshun94.github.io/shared/jquery/com/hiyoko/util/v2/utils.js"></script>
<script>
var io = {};
io.github = io.github || {};
io.github.shunshun94 = io.github.shunshun94 || {};
io.github.shunshun94.ytsheet = io.github.shunshun94.ytsheet || {};
io.github.shunshun94.ytsheet.addSkin = io.github.shunshun94.ytsheet.addSkin || {};

io.github.shunshun94.ytsheet.addSkin.param = com.hiyoko.util.getQueries();

if(io.github.shunshun94.ytsheet.addSkin.param.appendTextRightTop) {
	const item = document.createElement('span');
	item.id = 'image-append-right-top';
	item.style = `padding:0.8em;top:8px;right:8px;position:absolute;width:3em;writing-mode: vertical-rl;background-color:white;border:black solid 2px;font-weight: bold;`;
	item.textContent = decodeURI(io.github.shunshun94.ytsheet.addSkin.param.appendTextRightTop);
	document.getElementById('image').append(item);
}

if(io.github.shunshun94.ytsheet.addSkin.param.appendTextLeftBottom) {
	const item = document.createElement('span');
	item.id = 'image-append-left-bottom';
	item.style = `padding:0.8em;bottom:8px;left:8px;position:absolute;width:3em;writing-mode: vertical-rl;background-color:white;border:black solid 2px;font-weight: bold;`;
	item.textContent = decodeURI(io.github.shunshun94.ytsheet.addSkin.param.appendTextLeftBottom);
	document.getElementById('image').append(item);
}

// 編集画面は一旦一部のユーザにだけ解放している
['302451274706583553', '413974037501313024', '458592433865883659', '272299464486682624', '214107818947641346'].forEach((id)=>{
	if(document.cookie.includes(`ytsheet2=${id}%`)) {
		const base = document.getElementById('appendTextConsole');
		const textA = document.createElement('span');
		textA.textContent = '右上に挿入されるテキスト：';
		base.append(textA);
		const inputA = document.createElement('input');
		inputA.value = decodeURI(io.github.shunshun94.ytsheet.addSkin.param.appendTextRightTop || '');
		inputA.id = 'appendTextRightTop';
		base.append(inputA);
		base.append(document.createElement('br'));
		const textB = document.createElement('span');
		textB.textContent = '左下に挿入されるテキスト：';
		base.append(textB);
		const inputB = document.createElement('input');
		inputB.value = decodeURI(io.github.shunshun94.ytsheet.addSkin.param.appendTextLeftBottom || '');
		inputB.id = 'appendTextLeftBottom';
		base.append(inputB);
		base.append(document.createElement('br'));
		const appendTextApply = document.createElement('button');
		appendTextApply.textContent = '吹き出しを挿入'
		appendTextApply.onclick = (e)=>{
			const newUrlBase = `${location.origin}${location.pathname}?`;
			const params = [];
			if(io.github.shunshun94.ytsheet.addSkin.param.id) {
				params.push(`id=${io.github.shunshun94.ytsheet.addSkin.param.id}`);
			} else if (io.github.shunshun94.ytsheet.addSkin.param.url) {
				params.push(`url=${io.github.shunshun94.ytsheet.addSkin.param.url}`);
			}
			params.push(`appendTextRightTop=${encodeURI(inputA.value)}`);
			params.push(`appendTextLeftBottom=${encodeURI(inputB.value)}`);
			location.href = newUrlBase + params.join('&');
		};
		base.append(appendTextApply);
	}
});

const markdownLink = document.createElement('li');
markdownLink.setAttribute('class', 'link-tag');

const markdownLinkBase = document.createElement('span');
markdownLinkBase.appendChild(document.createTextNode('Discord共有用リンク'));
markdownLinkBase.appendChild(document.createElement('br'));

const markdownLinkInput = document.createElement('input');
markdownLinkInput.type = 'text';
markdownLinkInput.value = `[${document.getElementById('character-name').textContent}](${location.href})`;
markdownLinkInput.onclick = (e) => { e.target.select(); };

markdownLinkBase.appendChild(markdownLinkInput);

markdownLink.appendChild(markdownLinkBase);
document.getElementById('downloadlist').getElementsByTagName('ul')[0].appendChild(markdownLink);

</script>
